(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{"73c9":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{attrs:{padding:""}},[a("div",{staticClass:"q-pa-md"},[a("bc-boq-table",{attrs:{title:"Leistungsverzeichnis",data:e.data,loading:e.loading,"is-root":""},on:{assign:e.showDialog}})],1),a("q-dialog",{model:{value:e.prompt,callback:function(t){e.prompt=t},expression:"prompt"}},[a("q-card",{staticStyle:{"min-width":"450px"}},[a("q-card-section",{staticClass:"row items-center"},[a("div",{staticClass:"text-h6"},[e._v("Auftragsvergabe")]),a("q-space"),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),a("q-card-section",{staticClass:"q-pt-none"},[a("p",[e._v("\n          Geben Sie zur Auftragsvergabe\n          "),a("span",{staticClass:"text-weight-bold"},[e._v(e._s(e.selected&&(e.selected.short_desc||e.selected.name)))]),e._v("\n          bitte den gewünschten Auftragnehmer an:\n        ")]),a("q-input",{attrs:{filled:"",dense:"",placeholder:"Adresse",hint:"Blockchain Identität",autofocus:""},on:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.prompt=!1}},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"",color:"primary",label:"Auftrag vergeben"},on:{click:e.assign}})],1)],1)],1)],1)},s=[],r=(a("5db7"),a("73d9"),a("ded3")),i=a.n(r),o=a("c973"),l=a.n(o),d=a("9231"),c=a("7cd9");const p="0x852543528aF03b706b2785dFd3103898Ed256eaD";var u={name:"PageProjectBoqs",computed:{project(){return this.$store.getters["project/project"]}},mounted(){this.loadBoqs(),this.factoryContract.events.ServiceAgreementCreated().on("data",e=>{console.log("created agreement",e)})},methods:{loadBoqs(e){var t=this;return l()((function*(){t.loading=!0;const e=yield t.$orbitdb.boqdb;yield e.load();const a=yield e.query(e=>e.project_hash===t.$route.params.project);console.log("got boqs",a),t.boqs=a.map(e=>c["b"].from(e.children,e.items)),t.data=t.boqs[0],t.loading=!1}))()},showDialog(e){this.selected=e,this.prompt=!0},assign(){var e=this;return l()((function*(){e.selected.status=1;const t=i()({client:e.$auth.user().address,contractor:e.address},e.selected),a=e=>e.flatMap(e=>(e.status=1,a(e.children))),n=a(e.selected.children),s=n.map(e=>e.hash),r=n.map(e=>e.parent),o=n.map(e=>null!==e.billing_item);yield e.factoryContract.methods.createServiceAgreement(e.selected.hash,e.selected.parent,e.$auth.user().address,e.address,s,r,o,[]).send({from:e.$auth.user().address,gas:2e6});const l=yield e.$orbitdb.open(e.$route.params.project+"/services","keyvalue");console.log("service",t),yield l.put(t.hash,t),e.prompt=!1,console.log(""),console.log("assigned service",yield l.get(t.hash)),e.$q.notify({type:"positive",message:"Der Auftrag wurde erfolgreich vergeben",position:"bottom-right"})}))()}},data(){return{factoryContract:new this.$web3.eth.Contract(d["a"],p),selected:null,prompt:!1,address:"0x3c63d95ad664e6ef6006f6affdd8b77eae8a8bc8",boqs:[],data:[],loading:!0}}},y=u,b=a("2877"),m=a("9989"),h=a("eaac"),f=a("24e8"),g=a("f09f"),v=a("a370"),_=a("2c91"),q=a("9c40"),T=a("27f9"),w=a("4b7e"),C=a("7f67"),x=a("eebe"),A=a.n(x),k=Object(b["a"])(y,n,s,!1,null,null,null);t["default"]=k.exports;A()(k,"components",{QPage:m["a"],QTable:h["a"],QDialog:f["a"],QCard:g["a"],QCardSection:v["a"],QSpace:_["a"],QBtn:q["a"],QInput:T["a"],QCardActions:w["a"]}),A()(k,"directives",{ClosePopup:C["a"]})},"7cd9":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o}));var n=a("ded3"),s=a.n(n);const r=(e,t)=>e.split(".").reduce((e,t)=>e&&e[t],t);class i{static from(e,t){return e.map(e=>{const a=t[e],n=i.from(a.children,t);return s()(s()({},a),{},{children:n})})}static build(e,t,{builders:a,parent:n,billing:s}){const i=[];for(const o in a){const l=r(o,e);if(l){const e=Array.isArray(l)?l:Array.of(l);for(let r=0;r<e.length;r++){const l=a[o](e[r]);if(t[l.hash]=l,n?(l.addParent(n),t[n].children.push(l.hash)):i.push(l.hash),s){const e=s.items[l.hash];e&&(l.billing_item=e)}this.build(e[r],t,{builders:a,parent:l.hash,billing:s})}}}return{children:i,items:t}}}class o{constructor(){this.children=[],this.parent=null}addChild(e){this.children.push(e)}addParent(e){this.parent=e}}},9231:function(e){e.exports=JSON.parse('{"a":[{"inputs":[{"internalType":"address","name":"_implementation","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"_client","type":"address"},{"indexed":false,"internalType":"address","name":"_contractor","type":"address"},{"indexed":true,"internalType":"address","name":"_address","type":"address"},{"indexed":true,"internalType":"bytes32","name":"_hash","type":"bytes32"}],"name":"ServiceAgreementCreated","type":"event"},{"constant":true,"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"agreements","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"implementation","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"bytes32","name":"_service","type":"bytes32"},{"internalType":"bytes32","name":"_parent","type":"bytes32"},{"internalType":"address","name":"_client","type":"address"},{"internalType":"address","name":"_contractor","type":"address"},{"internalType":"bytes32[]","name":"_children","type":"bytes32[]"},{"internalType":"bytes32[]","name":"_parents","type":"bytes32[]"},{"internalType":"bool[]","name":"_billables","type":"bool[]"},{"internalType":"bytes32[]","name":"_documents","type":"bytes32[]"}],"name":"createServiceAgreement","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"bytes32","name":"_service","type":"bytes32"},{"internalType":"uint8","name":"_stage","type":"uint8"}],"name":"setServiceStage","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"}]}')}}]);